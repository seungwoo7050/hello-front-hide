FROM mcr.microsoft.com/playwright:v1.57.0-jammy

WORKDIR /app
COPY package*.json ./
RUN npm ci
COPY . .

ENV CI=true

RUN npm run build

CMD ["/bin/sh", "-c", "npm run preview -- --host --port 5173 >/tmp/vite-preview.log 2>&1 & npx wait-on http://127.0.0.1:5173 --timeout 30000 --verbose && npm run test:e2e -- --reporter=github"]
